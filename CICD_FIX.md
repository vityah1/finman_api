# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º CI/CD FinMan

## üö® –ü—Ä–æ–±–ª–µ–º–∞
```
FAILED: No 'script_location' key found in configuration.
```

## ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### 1. –°—Ç–≤–æ—Ä–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π alembic.ini –≤ –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É
- –§–∞–π–ª –º—ñ—Å—Ç–∏—Ç—å —Å–µ–∫—Ü—ñ—é `[alembic]` –∑ `script_location = migrations`
- –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è

### 2. –°—Ç–≤–æ—Ä–µ–Ω–æ –º—ñ–≥—Ä–∞—Ü—ñ—é –¥–ª—è –Ω–æ–≤–∏—Ö —Ç–∞–±–ª–∏—Ü—å
- `migrations/versions/2025_06_01_2030_add_utility_tables.py`
- –î–æ–¥–∞—î —Ç–∞–±–ª–∏—Ü—ñ –¥–ª—è –∫–æ–º—É–Ω–∞–ª—å–Ω–∏—Ö —Å–ª—É–∂–±:
  - `utility_addresses` - –∞–¥—Ä–µ—Å–∏/–¥–æ–º–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—Ç–≤–∞
  - `utility_services` - –∫–æ–º—É–Ω–∞–ª—å–Ω—ñ —Å–ª—É–∂–±–∏
  - `utility_tariffs` - —Ç–∞—Ä–∏—Ñ–∏
  - `utility_readings` - –ø–æ–∫–∞–∑–Ω–∏–∫–∏

### 3. –°—Ç–≤–æ—Ä–µ–Ω–æ —Å–∏—Å—Ç–µ–º—É –±–µ–∫–∞–ø—É –ë–î
- `backup_db.sh` - –æ—Å–Ω–æ–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –±–µ–∫–∞–ø—É
- `test_backup.sh` - —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ –±–µ–∫–∞–ø—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–∞—Ä—Å–∏—Ç—å .env –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

## üõ† –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–µ–∫–∞–ø—É –ë–î:
```bash
./backup_db.sh                    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –Ω–∞–∑–≤–∞ —Ñ–∞–π–ª—É
./backup_db.sh my_backup.sql      # –í–∫–∞–∑–∞–Ω–∞ –Ω–∞–∑–≤–∞ —Ñ–∞–π–ª—É
```

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –±–µ–∫–∞–ø—É:
```bash
./test_backup.sh
```

### –ó–∞–ø—É—Å–∫ –º—ñ–≥—Ä–∞—Ü—ñ–π:
```bash
# –í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ
docker exec finman_api alembic upgrade head

# –õ–æ–∫–∞–ª—å–Ω–æ –∑ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏–º —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ–º
source .venv/bin/activate
alembic upgrade head
```

## üìã –ù–æ–≤—ñ API –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏

### –ê–¥—Ä–µ—Å–∏:
- `GET /api/utilities/addresses` - —Å–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å
- `POST /api/utilities/addresses` - —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∞–¥—Ä–µ—Å—É
- `PATCH /api/utilities/addresses/{id}` - –æ–Ω–æ–≤–∏—Ç–∏
- `DELETE /api/utilities/addresses/{id}` - –≤–∏–¥–∞–ª–∏—Ç–∏

### –°–ª—É–∂–±–∏:
- `GET /api/utilities/services?address_id=1` - —Å–ª—É–∂–±–∏ –∞–¥—Ä–µ—Å–∏
- `POST /api/utilities/services` - —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Å–ª—É–∂–±—É
- `PATCH /api/utilities/services/{id}` - –æ–Ω–æ–≤–∏—Ç–∏
- `DELETE /api/utilities/services/{id}` - –≤–∏–¥–∞–ª–∏—Ç–∏

### –¢–∞—Ä–∏—Ñ–∏:
- `GET /api/utilities/tariffs?service_id=1` - —Ç–∞—Ä–∏—Ñ–∏ —Å–ª—É–∂–±–∏
- `POST /api/utilities/tariffs` - —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞—Ä–∏—Ñ
- `PATCH /api/utilities/tariffs/{id}` - –æ–Ω–æ–≤–∏—Ç–∏
- `DELETE /api/utilities/tariffs/{id}` - –≤–∏–¥–∞–ª–∏—Ç–∏

### –ü–æ–∫–∞–∑–Ω–∏–∫–∏:
- `GET /api/utilities/readings?address_id=1&period=2024-01` - –ø–æ–∫–∞–∑–Ω–∏–∫–∏
- `POST /api/utilities/readings` - –≤–Ω–µ—Å—Ç–∏ –ø–æ–∫–∞–∑–Ω–∏–∫
- `PATCH /api/utilities/readings/{id}` - –æ–Ω–æ–≤–∏—Ç–∏
- `DELETE /api/utilities/readings/{id}` - –≤–∏–¥–∞–ª–∏—Ç–∏

## üéØ –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏

1. **–°—Ç–≤–æ—Ä—ñ—Ç—å –∞–¥—Ä–µ—Å—É** (–ö–≤–∞—Ä—Ç–∏—Ä–∞, –î–∞—á–∞)
2. **–î–æ–¥–∞–π—Ç–µ —Å–ª—É–∂–±–∏ –¥–æ –∞–¥—Ä–µ—Å–∏** (–ï–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—è, –ì–∞–∑, –í–æ–¥–∞)
3. **–°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–∞—Ä–∏—Ñ–∏ –¥–ª—è —Å–ª—É–∂–±** (–º–æ–∂–Ω–∞ –∫—ñ–ª—å–∫–∞ –Ω–∞ —Å–ª—É–∂–±—É)
4. **–í–Ω–æ—Å—å—Ç–µ –ø–æ–∫–∞–∑–Ω–∏–∫–∏** - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑—Ä–∞—Ö—É—î —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è —Ç–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å

## üîß –ö–æ–º—ñ—Ç –¥–ª—è –¥–µ–ø–ª–æ—é
```bash
git add .
git commit -m "Fix CI/CD: add alembic.ini and utility tables [migrate]"
git push origin main
```

–ú—ñ—Ç–∫–∞ `[migrate]` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º—ñ–≥—Ä–∞—Ü—ñ—ó –ø—Ä–∏ –¥–µ–ø–ª–æ—ó.
